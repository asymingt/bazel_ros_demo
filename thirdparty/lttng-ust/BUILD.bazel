load("@rules_foreign_cc//foreign_cc:defs.bzl", "configure_make")

LIBRARY_TARGETS = [
    "lttng-ust-common",
    "lttng-ust-ctl",
    "lttng-ust-cyg-profile-fast",
    "lttng-ust-cyg-profile",
    "lttng-ust-dl",
    "lttng-ust-fd",
    "lttng-ust-fork",
    "lttng-ust-libc-wrapper",
    "lttng-ust-pthread-wrapper",
    "lttng-ust-tracepoint",
    "lttng-ust",
]

filegroup(
    name = "all",
    srcs = glob(["**"], exclude=["BUILD.bazel", "MODULE.bazel"]),
    visibility = ["//visibility:public"],
)

configure_make(
    name = "lttng-ust-project",
    lib_source = ":all",
    autogen = True,
    autogen_command = "bootstrap",
    configure_in_place = True,
    configure_options = [
        "--disable-examples",
        "--disable-man-pages",
    ],
    deps = [
        "@liburcu",
    ],
    out_binaries = ["lttng-gen-tp"],
    out_shared_libs = ["lib" + lib + ".so" for lib in LIBRARY_TARGETS],
    visibility = ["//visibility:public"],
)

filegroup(
    name = "lttng-gen-tp",
    output_group = "lttng-gen-tp",
    srcs = [":lttng-ust-project"],
)

[
    filegroup(
        name = pkg,
        output_group = "lib" + pkg + ".so",
        srcs = [":lttng-ust-project"],
    )
    for pkg in LIBRARY_TARGETS
]










